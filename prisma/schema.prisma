datasource db {
  provider = "postgresql"
  url = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Schedule {
  id Int @id @default(autoincrement())
  name String
  inviteCode String // Invite code to make it a bit more secure (should this be a separate table?)
  users ScheduleUser[]
}

// A temporary user local to each schedule
model ScheduleUser {
  id Int @id @default(autoincrement())
  name String
  schedule Schedule @relation(fields: [scheduleId], references: [id])
  scheduleId Int
  availability WeeklyAvailability?
  timezone String?
  exceptions ScheduleException[]
  passwordHash String?
  passwordSalt String?
  passwordSaltIterations Int?
}

model ScheduleException {
  id Int @id @default(autoincrement())
  user ScheduleUser @relation(fields: [userId], references: [id])
  userId Int @unique
  startTime DateTime
  endTime DateTime
  availability Availability
}

model WeeklyAvailability {
  id Int @id @default(autoincrement())
  user ScheduleUser @relation(fields: [userId], references: [id])
  userId Int @unique
  days DayAvailability[]
}

enum Day {
  SUNDAY
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
}

enum Availability {
  GREEN
  YELLOW
  RED
}

model DayAvailability {
  id Int @id @default(autoincrement())
  week WeeklyAvailability @relation(fields: [weekId], references: [id])
  weekId Int
  day Day
  availability Availability[]
}
